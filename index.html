<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>麻雀待ち牌チェッカー</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px; margin: 0 auto; background: white;
            border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .content { padding: 30px; }
        .info-box { margin-bottom: 15px; padding: 12px; background: #f0f7ff; border-radius: 10px; border: 1px solid #d0e3ff; }
        .info-title { font-size: 0.95em; font-weight: bold; color: #333; margin-bottom: 8px; }
        .info-list { list-style: none; padding: 0; margin: 0; }
        .info-list li { font-size: 0.85em; color: #555; margin-bottom: 4px; font-weight: 600; }
        .tiles-section { margin-bottom: 10px; }
        .suit-group { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .suit-title { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; color: #333; display: flex; align-items: center; }
        .suit-icon { width: 30px; height: 30px; margin-right: 10px; border-radius: 5px; }
        .man-icon { background: #8B4513; } .pin-icon { background: #DC143C; } .sou-icon { background: #228B22; } .ji-icon { background: #4B0082; }
        .tiles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
        .tile-button {
            display: flex; flex-direction: column; align-items: center; padding: 10px;
            background: white; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;
            transition: all 0.3s ease; position: relative; width: 100%; font-family: inherit;
        }
        .tile-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .tile-button.selected-1 { background: #e3f2fd; border-color: #2196f3; }
        .tile-button.selected-2 { background: #bbdefb; border-color: #1976d2; }
        .tile-button.selected-3 { background: #90caf9; border-color: #1565c0; }
        .tile-button.selected-4 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; }
        .tile-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .tile-button:disabled:hover { transform: none; box-shadow: none; }
        .tile-display { font-size: 1.8em; font-weight: bold; margin-bottom: 5px; }
        .tile-display.jihai { font-size: 1.5em; }
        .tile-count {
            position: absolute; top: -5px; right: -5px; background: #ff6b6b; color: white;
            border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
            font-size: 1.1em; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .controls { display: flex; gap: 10px; margin: 30px 0 20px 0; flex-wrap: wrap; }
        .btn { padding: 12px 30px; font-size: 1em; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .selected-count { padding: 10px 20px; background: #e9ecef; border-radius: 8px; font-weight: bold; }
        .result-section { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; min-height: 100px; }
        .result-title { font-size: 1.3em; font-weight: bold; margin-bottom: 15px; color: #333; }
        .waiting-tiles { display: flex; gap: 10px; flex-wrap: wrap; }
        .waiting-tile { padding: 15px 20px; background: white; border: 2px solid #667eea; border-radius: 8px; font-size: 1.2em; font-weight: bold; color: #667eea; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
        .no-waiting { color: #6c757d; font-style: italic; }
        .info-box { margin: 20px 0; padding: 15px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 5px; }
        .info-box h3 { margin-top: 0; color: #2e7d32; }
        .info-box ul { margin: 10px 0; padding-left: 25px; }
        .info-box li { margin: 5px 0; color: #424242; }
        .error-message { color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🀄 麻雀待ち牌チェッカー</h1>
            <p>13枚の牌を選択して、待ち牌を調べます</p>
            <p style="font-size: 0.9em; opacity: 0.9;">クリックで枚数増加（最大4枚） | 再クリックで0枚に戻る</p>
        </div>

        <div class="content">
            <div class="tiles-section">
                <!-- マンズ -->
                <div class="suit-group">
                    <div class="suit-title">
                        <div class="suit-icon man-icon"></div>
                        萬子（マンズ）
                    </div>
                    <div class="tiles-grid" id="man-tiles"></div>
                </div>

                <!-- ピンズ -->
                <div class="suit-group">
                    <div class="suit-title">
                        <div class="suit-icon pin-icon"></div>
                        筒子（ピンズ）
                    </div>
                    <div class="tiles-grid" id="pin-tiles"></div>
                </div>

                <!-- ソーズ -->
                <div class="suit-group">
                    <div class="suit-title">
                        <div class="suit-icon sou-icon"></div>
                        索子（ソーズ）
                    </div>
                    <div class="tiles-grid" id="sou-tiles"></div>
                </div>

                <!-- 字牌 -->
                <div class="suit-group">
                    <div class="suit-title">
                        <div class="suit-icon ji-icon"></div>
                        字牌（ジハイ）
                    </div>
                    <div class="tiles-grid" id="ji-tiles"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="checkWaiting()" id="checkBtn" disabled>待ち牌を調べる</button>
                <button class="btn btn-secondary" onclick="clearSelection()">選択をクリア</button>
                <div class="selected-count">選択中: <span id="selectedCount">0</span> / 13枚</div>
            </div>

            <div class="result-section">
                <div class="result-title">待ち牌</div>
                <div id="result">
                    <p class="no-waiting">13枚の牌を選択してください</p>
                </div>
            </div>
        </div>
    </div>

<script>
    const tiles = {
        man: [1,2,3,4,5,6,7,8,9],  // ← 1〜9に修正
        pin: [1,2,3,4,5,6,7,8,9],
        sou: [1,2,3,4,5,6,7,8,9],
        ji: ['東','南','西','北','白','發','中']
    };

    const tileCount = {};
    let selectedTotal = 0;

    function init() {
        const manContainer = document.getElementById('man-tiles');
        tiles.man.forEach(num => {
            const tileId = `m${num}`;
            tileCount[tileId] = 0;
            manContainer.innerHTML += createTileHTML('m', num);
        });

        const pinContainer = document.getElementById('pin-tiles');
        tiles.pin.forEach(num => {
            const tileId = `p${num}`;
            tileCount[tileId] = 0;
            pinContainer.innerHTML += createTileHTML('p', num);
        });

        const souContainer = document.getElementById('sou-tiles');
        tiles.sou.forEach(num => {
            const tileId = `s${num}`;
            tileCount[tileId] = 0;
            souContainer.innerHTML += createTileHTML('s', num);
        });

        const jiContainer = document.getElementById('ji-tiles');
        tiles.ji.forEach((char, index) => {
            const tileId = `z${index + 1}`;
            tileCount[tileId] = 0;
            jiContainer.innerHTML += createJihaiHTML(index + 1, char);
        });
    }

    function createTileHTML(suit, num) {
        const tileId = `${suit}${num}`;
        const suitName = suit === 'm' ? '萬' : suit === 'p' ? '筒' : '索';
        return `
            <button id="${tileId}" class="tile-button" onclick="updateTileSelection('${tileId}')" type="button">
                <span class="tile-display">${num}</span>
                <span style="font-size: 0.8em">${suitName}</span>
                <span class="tile-count" id="count-${tileId}" style="display: none;">0</span>
            </button>
        `;
    }

    function createJihaiHTML(num, char) {
        const tileId = `z${num}`;
        return `
            <button id="${tileId}" class="tile-button" onclick="updateTileSelection('${tileId}')" type="button">
                <span class="tile-display jihai">${char}</span>
                <span class="tile-count" id="count-${tileId}" style="display: none;">0</span>
            </button>
        `;
    }

    function updateTileSelection(tileId) {
        const button = document.getElementById(tileId);
        const countSpan = document.getElementById(`count-${tileId}`);
        const currentCount = tileCount[tileId];

        let newCount;
        if (currentCount >= 4) {
            newCount = 0;
        } else {
            if (selectedTotal - currentCount + currentCount + 1 > 13) {
                newCount = 0;
            } else {
                newCount = currentCount + 1;
            }
        }

        selectedTotal = selectedTotal - currentCount + newCount;
        tileCount[tileId] = newCount;

        button.className = 'tile-button';
        if (newCount > 0) {
            button.classList.add(`selected-${newCount}`);
            countSpan.textContent = newCount;
            countSpan.style.display = 'flex';
        } else {
            countSpan.style.display = 'none';
        }

        updateUI();
    }

    function updateUI() {
        document.getElementById('selectedCount').textContent = selectedTotal;
        document.getElementById('checkBtn').disabled = (selectedTotal !== 13);

        Object.keys(tileCount).forEach(tileId => {
            const button = document.getElementById(tileId);
            const currentCount = tileCount[tileId];
            if (selectedTotal >= 13 && currentCount === 0) {
                button.disabled = true;
            } else {
                button.disabled = false;
            }
        });
    }

    function clearSelection() {
        Object.keys(tileCount).forEach(tileId => {
            tileCount[tileId] = 0;
            const button = document.getElementById(tileId);
            button.className = 'tile-button';
            button.disabled = false;
            document.getElementById(`count-${tileId}`).style.display = 'none';
        });
        selectedTotal = 0;
        updateUI();
        document.getElementById('result').innerHTML = '<p class="no-waiting">13枚の牌を選択してください</p>';
    }

    function checkWaiting() {
        const hand = [];
        Object.keys(tileCount).forEach(tileId => {
            for (let i = 0; i < tileCount[tileId]; i++) {
                hand.push(tileId);
            }
        });

        const waitingTiles = findWaitingTiles(hand);
        displayResult(waitingTiles);
    }

    function findWaitingTiles(hand) {
        const waiting = [];
        const allTiles = [];

        tiles.man.forEach(n => allTiles.push(`m${n}`));
        tiles.pin.forEach(n => allTiles.push(`p${n}`));
        tiles.sou.forEach(n => allTiles.push(`s${n}`));
        tiles.ji.forEach((_, index) => allTiles.push(`z${index + 1}`));

        const kokushi13 = checkKokushi13Wait(hand);
        if (kokushi13.length > 0) return kokushi13;

        for (const tile of allTiles) {
            const currentCount = hand.filter(t => t === tile).length;
            if (currentCount >= 4) continue;

            const testHand = [...hand, tile].sort();
            if (isWinningHand(testHand)) waiting.push(tile);
        }

        return waiting;
    }

    function checkKokushi13Wait(hand) {
        const yaochuuTiles = ['m1','m9','p1','p9','s1','s9','z1','z2','z3','z4','z5','z6','z7'];
        if (hand.length !== 13) return [];
        const counts = {};
        hand.forEach(tile => counts[tile] = (counts[tile] || 0) + 1);

        for (const tile of hand) if (!yaochuuTiles.includes(tile)) return [];

        let allSingle = true;
        for (const tile of yaochuuTiles) {
            const c = counts[tile] || 0;
            if (c !== 1) { allSingle = false; break; }
        }
        if (allSingle) return yaochuuTiles;
        return [];
    }

    function isWinningHand(hand) {
        const counts = {};
        hand.forEach(tile => counts[tile] = (counts[tile] || 0) + 1);
        if (isKokushimusou(counts)) return true;
        if (isChitoitsu(counts)) return true;
        return checkNormalWin(counts);
    }

    function isKokushimusou(counts) {
        const yaochuuTiles = ['m1','m9','p1','p9','s1','s9','z1','z2','z3','z4','z5','z6','z7'];
        let pairCount = 0, singleCount = 0;

        for (const tile of yaochuuTiles) {
            const c = counts[tile] || 0;
            if (c === 0) return false;
            else if (c === 1) singleCount++;
            else if (c === 2) pairCount++;
            else return false;
        }
        for (const [tile, c] of Object.entries(counts)) {
            if (!yaochuuTiles.includes(tile) && c > 0) return false;
        }
        return pairCount === 1 && singleCount === 12;
    }

    function isChitoitsu(counts) {
        const pairs = Object.values(counts).filter(c => c === 2).length;
        return pairs === 7;
    }

    function checkNormalWin(counts) {
        for (const [tile, c] of Object.entries(counts)) {
            if (c >= 2) {
                const t = {...counts}; t[tile] -= 2;
                if (checkMentsu(t)) return true;
            }
        }
        return false;
    }

    function checkMentsu(counts) {
        const tiles = [];
        for (const [tile, c] of Object.entries(counts)) {
            for (let i = 0; i < c; i++) tiles.push(tile);
        }
        if (tiles.length === 0) return true;
        return removeMentsu(counts);
    }

    function removeMentsu(counts) {
        const total = Object.values(counts).reduce((s, c) => s + c, 0);
        if (total === 0) return true;
        const tiles = Object.keys(counts).filter(t => counts[t] > 0).sort();
        if (tiles.length === 0) return true;
        const first = tiles[0];

        if (counts[first] >= 3) {
            const n = {...counts}; n[first] -= 3;
            if (removeMentsu(n)) return true;
        }

        const suit = first[0];
        if (suit !== 'z') {
            const num = parseInt(first.substring(1));
            const next1 = `${suit}${num + 1}`;
            const next2 = `${suit}${num + 2}`;
            if ((counts[first]||0)>=1 && (counts[next1]||0)>=1 && (counts[next2]||0)>=1) {
                const n = {...counts};
                n[first]--; n[next1]--; n[next2]--;
                if (removeMentsu(n)) return true;
            }
        }
        return false;
    }

    init();
</script>
</body>
</html>
